# 异常

- 异常本身是一个类，产生异常就是创建异常对象并抛出
- 根类是Throwable，Error子类是不能处理只能避免的问题，Exception是使用不当导致的
- 异常分为编译期异常和运行期异常
- 异常处理方法：抛出异常交给虚拟机处理；也可try/catch，try放可能会异常代码，catch放解决方法



## 异常产生

- 产生过程：
  - JVM根据异常产生原因创建一个异常对象，包含异常产生的内容、原因和位置
  - 没有trycatch则把异常抛给调用者，比如main
  - 调用者没有处理方法则重新抛给JVM
  - JVM抛出给控制台(中断处理：打印+中止)
  - 一级级向上抛出



## 异常处理

- throw关键字：在指定的方法中抛出指定的异常

  - 格式

    ```java
    throw new xxxException("异常产生的原因");
    ```

  - 注意事项

    - 必须写在方法内部
    - new的对象必须是Exception或其子类对象
    - 抛出后必须处理，如果是runtime可以不处理交给JVM处理
    - 如果是编译异常必须处理，throws或者trycatch

  - 在实际工作中必须首先对参数进行合法性校验并抛出异常

  - 使用Objects.requiresNonNull()简化空指针异常判断

  - Throwable类中定义了3个异常处理方法：String getMessage()、String toString()、void printStackTrace()，返回的信息从略到详



## 声明异常throws

- 自己不处理，给调用者处理，在方法声明时使用

- 格式

  ```java
  修饰符 返回值类型 方法名(参数列表) throws AAAException, BBBException...{
      throw new AAAException("产生原因");
      throw new BBBException("产生原因");
  }
  ```

- 注意事项

  - 必须写在方法声明处
  - 声明的必须是异常或者异常子类
  - 如果抛出多个异常对象，也必须声明多个
  - 如果有子父类则只声明父类
  - 调用该方法则必须处理异常，要么继续在调用函数处继续throws给JVM处理，要么trycatch自己处理



## try..catch处理异常

- 为了不中断处理

- 格式

  ```java
  try{
      可能会产生异常的代码
  }catch(定义一个异常变量用于接收抛出的异常){
      异常处理逻辑，通常写入到日志文件中
  }
  ...
  catch(){}
  ```

- 注意

  - 抛出多个就catch多个
  - 出现异常执行完catch后可以继续执行程序
  - 在调用处使用try...catch



## finally代码块

- 无论是否异常都必须执行的代码
- 注意
  - 必须跟try catch一起使用，写在catch之后
  - 一般用于资源释放
  - 不要在finally中写return，因为永远会执行



## 多个异常

- 分别处理：每个异常用一个trycatch
- 一次捕获，多次处理：一个try多个catch，子类异常必须先处理
- 一次捕获，一次处理：定义一个父类异常对象接收所有异常



## 自定义异常

- 必须继承Exception或者RuntimeException
- 添加空参数构造方法和异常信息的构造方法：直接调用父类构造方法super()处理异常信息即可
- 编辑期异常必须处理